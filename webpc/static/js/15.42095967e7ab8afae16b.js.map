{"version":3,"sources":["webpack:///src/view/publishDt.vue","webpack:///./src/view/publishDt.vue?35de","webpack:///./src/view/publishDt.vue"],"names":["OSS","__webpack_require__","publishDt","components","headerNav","FoodItem","foodItem","FooterBottom","footer","data","osshost","dialogImageUrl","imgList","dialogVisible","campaignid","keword","form","type","itemid","description","videourl","dtimg","cpid","token","created","this","$store","state","user","$route","query","aid","methods","onSubmit","_this","length","i","Object","action","then","response","success","element_ui_common","message","duration","$router","go","error","console","log","handleHttpRequest","a","_this2","imageUrl","file","name","operate","res","result","imgUrl","spaceid","tools","imgMd5","region","accessKeyId","AccessKeyId","accessKeySecret","AccessKeySecret","stsToken","SecurityToken","bucket","put","results","index","key","$set","push","catch","err","code","setTimeout","path","view_publishDt","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","id","_v","ref","model","label-width","label","staticStyle","width","value","callback","$$v","expression","_l","item","http-request","show-file-list","src","on","click","staticRenderFns","Component","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/15.42095967e7ab8afae16b.js","sourcesContent":["<template>\r\n  <div>\r\n    <div id=\"header\" class=\"content\">\r\n      <header-nav></header-nav>\r\n    </div>\r\n    <div class=\"content padding-top-100\">\r\n\r\n      <el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\r\n\r\n        <el-form-item label=\"简介\">\r\n          <el-input type=\"textarea\" v-model=\"form.description\" style=\"width: 500px;\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"动态图\">\r\n          <el-upload\r\n            action=\"#\"\r\n            :http-request=\"handleHttpRequest\"\r\n            :show-file-list=\"false\"\r\n            class=\"avatar-uploader\"\r\n            v-for=\"(item, index) in imgList\"\r\n            :key=\"index\"\r\n            :data=\"{key:index+1}\"\r\n           >\r\n            <img v-if=\"item!=null\" :src=\"osshost+item\" class=\"avatar\">\r\n            <i v-else class=\"el-icon-plus step-upicon\">点击上传</i>\r\n          </el-upload>\r\n          <el-upload\r\n            action=\"#\"\r\n            :http-request=\"handleHttpRequest\"\r\n            :show-file-list=\"false\"\r\n            class=\"avatar-uploader\"\r\n          >\r\n            <i class=\"el-icon-plus step-upicon\">点击上传</i>\r\n          </el-upload>\r\n          <el-tag type=\"info\">只能上传jpg/png文件，且不超过5mb</el-tag>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"success\" @click=\"onSubmit\">发布动态</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <FooterBottom></FooterBottom>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import headerNav from \"@/components/headerNav\";\r\n  import FoodItem from \"@/components/foodItem\";\r\n  import FooterBottom from \"@/components/footer\";\r\n  import {uploadImg} from '@/api/operate'\r\n  import {pushDt} from '@/api/action'\r\n  import {Message} from 'element-ui'\r\n  import tools from '@/utils/tools'\r\n\r\n  let OSS = require('ali-oss');\r\n  export default {\r\n    components: {\r\n      headerNav,\r\n      FoodItem,\r\n      FooterBottom\r\n    },\r\n    data() {\r\n      return {\r\n        osshost: process.env.UPLOAD_URL,\r\n        dialogImageUrl: '',\r\n        imgList: [],\r\n        dialogVisible: false,\n        campaignid:'',\n        keword:'',\r\n        form: {\r\n          type:0,\r\n          itemid:'',\r\n          description: '',\r\n          videourl:'',\r\n          dtimg: '',\n          campaignid:''\r\n        },\r\n        cpid:'',\r\n        token: ''\r\n      }\r\n    },\r\n    created() {\r\n      this.token = this.$store.state.user.token;\r\n      this.cpid =this.$route.query.cpid;\n      this.campaignid = this.$route.query.aid;\n      this.keword = this.$route.query.keword;\n      if(this.keword){\n        this.form.description='#'+this.keword+'#';\n      }\r\n    },\r\n    methods: {\r\n      onSubmit() {\r\n        if (this.form.description == '') {\r\n          Message({\r\n            message: '动态描述不能为空',\r\n            type: 'success',\r\n            duration: 5 * 1000\r\n          })\r\n          return;\r\n        }\r\n        if (this.imgList.length == 0) {\r\n          Message({\r\n            message: '动态图片不能为空',\r\n            type: 'success',\r\n            duration: 5 * 1000\r\n          })\r\n          return;\r\n        }\r\n        for (var i = 0; i < this.imgList.length; i++) {\r\n          if (i == 0) {\r\n            this.form.dtimg = this.imgList[0];\r\n          } else {\r\n            this.form.dtimg = this.form.dtimg + '|' + this.imgList[i];\r\n          }\r\n        }\r\n\r\n        this.form.type=0;//0:纯动态，1：食谱关联动态，2：主题关联动态，3：作品关联动态\r\n        if(this.cpid){\r\n          this.form.type=1;\r\n          this.form.itemid=this.cpid;\r\n        }\n        if(this.campaignid!=0){\n          this.form.campaignid=this.campaignid;\n        }\r\n        pushDt(this.form).then(response => {\r\n          let res = response.data;\r\n          if (res.success) {\r\n            Message({\r\n              message: '发布成功！',\r\n              type: 'success',\r\n              duration: 5 * 1000\r\n            });\n            this.$router.go(-1);//返回上一层\r\n          } else {\r\n            Message({\r\n              message: '发布失败！',\r\n              type: 'warning',\r\n              duration: 5 * 1000\r\n            })\r\n          }\r\n        }).then(error => {\r\n          console.log(error)\r\n        })\r\n      },\r\n      handleHttpRequest(a) {//上传封面图\r\n        console.log(a)\r\n        let imageUrl = a.file.name;\r\n        let type = 2;\r\n        uploadImg(type).then(response => {\r\n          let res = response.data;\r\n          let result = response.data.result;\r\n          if (res.success) {\r\n            let imgUrl;\r\n            imgUrl = result.spaceid + '/' + tools.imgMd5(imageUrl, imgUrl, 'pushimg');//文件名 加密\r\n            const client = new OSS({\r\n              region: 'oss-cn-hangzhou',\n              accessKeyId: result.AccessKeyId,\n              accessKeySecret: result.AccessKeySecret,\n              stsToken: result.SecurityToken,\n              bucket: 'guanfan'//请求阿里云之后获得\r\n            })\r\n            client.put(imgUrl, a.file).then(results => {\r\n              if(a.data){\r\n                let index=a.data.key-1;\r\n                this.$set(this.imgList, index, results.name)\r\n              }else{\r\n                this.imgList.push(results.name);\r\n              }\r\n              console.log('头像上传成功');\r\n            }).catch((err) => {\r\n              console.log(err);\r\n            });\r\n          } else {\r\n            Message({\r\n              message: res.message,\r\n              type: 'success',\r\n              duration: 5 * 1000\r\n            })\r\n            if (res.code == '9999') {\r\n              setTimeout(function () {\r\n                this.$router.push({path: \"/login\"})\r\n              }, 3000)\r\n            }\r\n          }\r\n\r\n        }).catch(error => {\r\n          console.log(error)\r\n        })\r\n      },\r\n\r\n    }\r\n  };\r\n</script>\r\n\r\n<style scoped>\r\n  .step-upicon {\r\n    border: 1px dashed #d9d9d9;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    position: relative;\r\n    overflow: hidden;\r\n    font-size: 14px;\r\n    color: #8c939d;\r\n    width: 150px;\r\n    height: 150px;\r\n    line-height: 150px;\r\n    text-align: center;\r\n  }\r\n\r\n  .step-upicon:hover {\r\n    border-color: #409EFF;\r\n  }\r\n  .avatar {\r\n    width: 200px;\r\n    height: 200px;\r\n    display: block;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/view/publishDt.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"content\",attrs:{\"id\":\"header\"}},[_c('header-nav')],1),_vm._v(\" \"),_c('div',{staticClass:\"content padding-top-100\"},[_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.form,\"label-width\":\"80px\"}},[_c('el-form-item',{attrs:{\"label\":\"简介\"}},[_c('el-input',{staticStyle:{\"width\":\"500px\"},attrs:{\"type\":\"textarea\"},model:{value:(_vm.form.description),callback:function ($$v) {_vm.$set(_vm.form, \"description\", $$v)},expression:\"form.description\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"动态图\"}},[_vm._l((_vm.imgList),function(item,index){return _c('el-upload',{key:index,staticClass:\"avatar-uploader\",attrs:{\"action\":\"#\",\"http-request\":_vm.handleHttpRequest,\"show-file-list\":false,\"data\":{key:index+1}}},[(item!=null)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.osshost+item}}):_c('i',{staticClass:\"el-icon-plus step-upicon\"},[_vm._v(\"点击上传\")])])}),_vm._v(\" \"),_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":\"#\",\"http-request\":_vm.handleHttpRequest,\"show-file-list\":false}},[_c('i',{staticClass:\"el-icon-plus step-upicon\"},[_vm._v(\"点击上传\")])]),_vm._v(\" \"),_c('el-tag',{attrs:{\"type\":\"info\"}},[_vm._v(\"只能上传jpg/png文件，且不超过5mb\")])],2),_vm._v(\" \"),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"success\"},on:{\"click\":_vm.onSubmit}},[_vm._v(\"发布动态\")])],1)],1)],1),_vm._v(\" \"),_c('FooterBottom')],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-281439f2\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/view/publishDt.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-281439f2\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./publishDt.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./publishDt.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./publishDt.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-281439f2\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./publishDt.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-281439f2\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/view/publishDt.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}