webpackJsonp([15],{oEss:function(t,e){},"u+79":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("JJSs"),a=s("wqlu"),o=s("mzkE"),n=s("3/Li"),c=s("lCmq"),r=s("zL8q"),l=s("GKmE"),u=s("/Z0X"),d={components:{headerNav:i.a,FoodItem:a.a,FooterBottom:o.a},data:function(){return{osshost:"https://guanfan.oss-cn-hangzhou.aliyuncs.com/",dialogImageUrl:"",imgList:[],dialogVisible:!1,campaignid:"",keword:"",form:{type:0,itemid:"",description:"",videourl:"",dtimg:"",campaignid:""},cpid:"",token:""}},created:function(){this.token=this.$store.state.user.token,this.cpid=this.$route.query.cpid,this.campaignid=this.$route.query.aid,this.keword=this.$route.query.keword,this.keword&&(this.form.description="#"+this.keword+"#")},methods:{onSubmit:function(){var t=this;if(""!=this.form.description)if(0!=this.imgList.length){for(var e=0;e<this.imgList.length;e++)this.form.dtimg=0==e?this.imgList[0]:this.form.dtimg+"|"+this.imgList[e];this.form.type=0,this.cpid&&(this.form.type=1,this.form.itemid=this.cpid),0!=this.campaignid&&(this.form.campaignid=this.campaignid),Object(c.e)(this.form).then(function(e){e.data.success?(Object(r.Message)({message:"发布成功！",type:"success",duration:5e3}),t.$router.go(-1)):Object(r.Message)({message:"发布失败！",type:"warning",duration:5e3})}).then(function(t){console.log(t)})}else Object(r.Message)({message:"动态图片不能为空",type:"success",duration:5e3});else Object(r.Message)({message:"动态描述不能为空",type:"success",duration:5e3})},handleHttpRequest:function(t){var e=this;console.log(t);var s=t.file.name;Object(n.i)(2).then(function(i){var a=i.data,o=i.data.result;if(a.success){var n=void 0;n=o.spaceid+"/"+l.a.imgMd5(s,n,"pushimg"),new u({region:"oss-cn-hangzhou",accessKeyId:o.AccessKeyId,accessKeySecret:o.AccessKeySecret,stsToken:o.SecurityToken,bucket:"guanfan"}).put(n,t.file).then(function(s){if(t.data){var i=t.data.key-1;e.$set(e.imgList,i,s.name)}else e.imgList.push(s.name);console.log("头像上传成功")}).catch(function(t){console.log(t)})}else Object(r.Message)({message:a.message,type:"success",duration:5e3}),"9999"==a.code&&setTimeout(function(){this.$router.push({path:"/login"})},3e3)}).catch(function(t){console.log(t)})}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"content",attrs:{id:"header"}},[s("header-nav")],1),t._v(" "),s("div",{staticClass:"content padding-top-100"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[s("el-form-item",{attrs:{label:"简介"}},[s("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"动态图"}},[t._l(t.imgList,function(e,i){return s("el-upload",{key:i,staticClass:"avatar-uploader",attrs:{action:"#","http-request":t.handleHttpRequest,"show-file-list":!1,data:{key:i+1}}},[null!=e?s("img",{staticClass:"avatar",attrs:{src:t.osshost+e}}):s("i",{staticClass:"el-icon-plus step-upicon"},[t._v("点击上传")])])}),t._v(" "),s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"#","http-request":t.handleHttpRequest,"show-file-list":!1}},[s("i",{staticClass:"el-icon-plus step-upicon"},[t._v("点击上传")])]),t._v(" "),s("el-tag",{attrs:{type:"info"}},[t._v("只能上传jpg/png文件，且不超过5mb")])],2),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"success"},on:{click:t.onSubmit}},[t._v("发布动态")])],1)],1)],1),t._v(" "),s("FooterBottom")],1)},staticRenderFns:[]};var h=s("VU/8")(d,m,!1,function(t){s("oEss")},"data-v-281439f2",null);e.default=h.exports}});
//# sourceMappingURL=15.42095967e7ab8afae16b.js.map