webpackJsonp([3],{"7vBx":function(t,e){},yKW3:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s("JJSs"),i=s("wqlu"),a=s("mzkE"),n=s("zL8q"),l=s("3/Li"),r=s("bUp0"),c=s("GKmE"),u=s("/Z0X"),f={components:{headerNav:o.a,FoodItem:i.a,FooterBottom:a.a},data:function(){return{osshost:"https://guanfan.oss-cn-hangzhou.aliyuncs.com/",stepIndex:0,type:"",campaignid:"",keword:"",form:{title:"",cpimg:null,difficult:"",spendtime:"",tip:"",stuff:"",step:"",ispushweb:!0,ispushdt:!0,campaignid:""},stuffList:[{num:"",name:""}],stepList:[{stepImg:null,description:""}],hardSort:["入门","中级","高级"],timeSort:["10分钟以下","10~30分钟","30~60分钟","1小时以上"]}},mounted:function(){},created:function(){this.cpid=this.$route.query.id,this.campaignid=this.$route.query.aid,this.keword=this.$route.query.keword,this.type=this.$route.query.type,this.keword&&(this.form.title="#"+this.keword+"#"),3==this.type&&this.getDataInfo(this.cpid)},methods:{getDataInfo:function(t){var e=this;Object(r.c)(t).then(function(t){var s=t.data;if(s.success){e.form=s.result,e.stepList=e.form.step,e.stuffList=e.form.stuff.split("|");for(var o=0;o<e.stuffList.length;o++){var i;i=e.stuffList[o].split("#"),e.stuffList[o]={name:i[0],num:i[1]}}}else Object(n.Message)({message:t.message,type:"error",duration:5e3})}).catch(function(t){console.log(t)})},handleHttpRequest:function(t){var e=this,s=t.file.name;Object(l.i)(1).then(function(o){var i=o.data.result,a=void 0;a=i.spaceid+"/"+c.a.imgMd5(s,a,"caipu"),new u({region:"oss-cn-hangzhou",accessKeyId:i.AccessKeyId,accessKeySecret:i.AccessKeySecret,stsToken:i.SecurityToken,bucket:"guanfan"}).put(a,t.file).then(function(t){e.form.cpimg=t.name,console.log("头像上传成功")}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})},handleRemove:function(){this.form.cpimg=null},delFood:function(t){-1!==t&&this.stuffList.splice(t,1)},addFood:function(){this.stuffList.push({name:"",num:""})},delStep:function(t){this.stepList.splice(t,1)},addstep:function(){this.stepList.push({stepImg:null,description:""})},stepHttpRequest:function(t){var e=this,s=t.file.name,o=t.data.a;Object(l.i)(1).then(function(i){var a=i.data;if(a.success){var n=a.result,l=void 0;l=n.spaceid+"/"+c.a.imgMd5(s,l,"caipu"),new u({region:"oss-cn-hangzhou",accessKeyId:n.AccessKeyId,accessKeySecret:n.AccessKeySecret,stsToken:n.SecurityToken,bucket:"guanfan"}).put(l,t.file).then(function(t){e.stepList[o].stepImg=t.name,console.log(e.stepList[o].stepImg),console.log("头像上传成功")}).catch(function(t){console.log(t)})}}).then(function(t){console.log(t)})},uploadFood:function(t){var e=this;function s(t,e,s){if(1==s)for(var o=0;o<e.length;o++)t+=0==o?e[o].name+"#"+e[o].num:"|"+e[o].name+"#"+e[o].num;else for(o=0;o<e.length;o++)t+=0==o?o+1+"#"+e[o].stepImg+"#"+e[o].description:"|"+(o+1)+"#"+e[o].stepImg+"#"+e[o].description;return t}this.form.type=t,this.form.stuff=s(this.form.stuff,this.stuffList,1),this.form.step=s(this.form.step,this.stepList,2),console.log(this.form.step),0!=this.campaignid&&(this.form.campaignid=this.campaignid),1==this.form.ispushweb?this.form.ispushweb=1:this.form.ispushweb=0,1==this.form.ispushdt?this.form.ispushdt=1:this.form.ispushdt=0,Object(r.e)(this.form).then(function(t){t.data.success?(Object(n.Message)({message:"发布成功！",type:"success",duration:5e3}),e.$router.go(-1)):Object(n.Message)({message:"发布失败！",type:"error",duration:5e3})}).catch(function(t){console.log(t),e.form.stuff=e.form.stuff,e.form.step=e.form.step})},uploadeFood:function(t){function e(t,e,s){if(1==s)for(var o=0;o<e.length;o++)t+=0==o?e[o].name+"#"+e[o].num:"|"+e[o].name+"#"+e[o].num;else for(o=0;o<e.length;o++)t+=0==o?o+1+"#"+e[o].url+"#"+e[o].description:"|"+(o+1)+"#"+e[o].url+"#"+e[o].description;return t}this.form.type=t,this.form.stuff=e(this.form.stuff,this.stuffList,1),this.form.step=e(this.form.step,this.stepList,2),1==this.form.ispushweb?this.form.ispushweb=1:this.form.ispushweb=0,1==this.form.ispushdt?this.form.ispushdt=1:this.form.ispushdt=0,Object(r.f)(this.form).then(function(t){t.data.success?Object(n.Message)({message:"修改成功！",type:"success",duration:5e3}):Object(n.Message)({message:"修改失败！",type:"error",duration:5e3})}).catch(function(t){console.log(t)})}}},p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"content",attrs:{id:"header"}},[s("header-nav")],1),t._v(" "),s("div",{staticClass:"content padding-top-100"},[s("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[s("div",{staticClass:"tu"},[s("el-form-item",{attrs:{label:"成品图"}},[s("el-upload",{staticClass:"avatar-uploader",attrs:{action:"#","http-request":t.handleHttpRequest,"show-file-list":!1,"on-remove":t.handleRemove}},[null!=t.form.cpimg?s("img",{staticClass:"avatar",attrs:{src:t.osshost+t.form.cpimg}}):s("i",{staticClass:"el-icon-plus step-upicon avatar"},[t._v("点击上传")])]),t._v(" "),s("el-tag",{attrs:{type:"info"}},[t._v("只能上传jpg/png文件，且不超过5mb")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"菜谱名称"}},[s("el-input",{staticStyle:{width:"500px"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"食谱简介"}},[s("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea"},model:{value:t.form.story,callback:function(e){t.$set(t.form,"story",e)},expression:"form.story"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"烹饪难度"}},[s("el-select",{attrs:{placeholder:"请选择难度"},model:{value:t.form.difficult,callback:function(e){t.$set(t.form,"difficult",e)},expression:"form.difficult"}},t._l(t.hardSort,function(t,e){return s("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"耗时"}},[s("el-select",{attrs:{placeholder:"请选择耗时"},model:{value:t.form.spendtime,callback:function(e){t.$set(t.form,"spendtime",e)},expression:"form.spendtime"}},t._l(t.timeSort,function(t,e){return s("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1),t._v(" "),s("el-form-item",{attrs:{label:"食材清单"}},[s("el-form-item",{staticClass:"ml10"},[s("el-col",{attrs:{span:8}},[t._v("\n            食材\n          ")]),t._v(" "),s("el-col",{staticClass:"line",attrs:{span:2}}),t._v(" "),s("el-col",{staticClass:"ml30",attrs:{span:8}},[t._v("\n            用量\n          ")])],1),t._v(" "),t._l(t.stuffList,function(e,o){return s("el-form-item",{key:o,staticClass:"mb10"},[s("el-col",{attrs:{span:8}},[s("el-input",{attrs:{placeholder:"食材：如五花肉"},model:{value:e.name,callback:function(s){t.$set(e,"name",s)},expression:"item.name"}})],1),t._v(" "),s("el-col",{staticClass:"ml30",attrs:{span:8}},[s("el-input",{attrs:{placeholder:"用量：如500g"},model:{value:e.num,callback:function(s){t.$set(e,"num",s)},expression:"item.num"}})],1),t._v(" "),s("el-col",{staticClass:"ml10",attrs:{span:4}},[s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",plain:""},on:{click:function(e){return e.preventDefault(),t.delFood(o)}}})],1)],1)}),t._v(" "),s("el-button",{on:{click:function(e){return t.addFood()}}},[t._v("添加1个食材")])],2),t._v(" "),s("el-form-item",{attrs:{label:"制作步骤"}},[s("el-tag",{attrs:{type:"info"}},[t._v("只能上传jpg/png文件，且不超过5mb")])],1),t._v(" "),t._l(t.stepList,function(e,o){return s("el-form-item",{key:o,staticClass:"mb10",attrs:{id:"step_upload"}},[s("el-col",{attrs:{span:2}},[s("el-tag",{attrs:{type:"info"}},[t._v("第"+t._s(o+1)+"步")])],1),t._v(" "),s("el-col",{attrs:{span:9}},[s("el-upload",{attrs:{action:"#",data:{a:o},"http-request":t.stepHttpRequest,"show-file-list":!1}},[null!=e.stepImg?s("img",{staticClass:"avatar",attrs:{src:t.osshost+e.stepImg}}):s("i",{staticClass:"el-icon-plus step-upicon avatar"},[t._v("点击上传")])]),t._v(" "),s("el-input",{staticStyle:{width:"350px"},attrs:{type:"textarea",maxlength:"120","show-word-limit":""},model:{value:e.description,callback:function(s){t.$set(e,"description",s)},expression:"item.description"}})],1),t._v(" "),s("el-col",{staticClass:"ml10",attrs:{span:4}},[s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",plain:""},on:{click:function(e){return e.preventDefault(),t.delStep(o)}}})],1)],1)}),t._v(" "),s("el-form-item",[s("el-button",{on:{click:function(e){return t.addstep()}}},[t._v("添加1个步骤")])],1),t._v(" "),s("el-form-item",{attrs:{label:"小贴士"}},[s("el-tag",{attrs:{type:"info"}},[t._v("（选填，关于这道菜的注意事项、小秘诀，不超过300字）")]),t._v(" "),s("el-input",{attrs:{type:"textarea"},model:{value:t.form.tip,callback:function(e){t.$set(t.form,"tip",e)},expression:"form.tip"}})],1),t._v(" "),s("el-form-item",[s("el-checkbox-group",{model:{value:t.form.ispushweb,callback:function(e){t.$set(t.form,"ispushweb",e)},expression:"form.ispushweb"}},[s("el-checkbox",{attrs:{label:"独家菜谱【只在管饭网发布】"}})],1),t._v(" "),s("el-checkbox-group",{model:{value:t.form.ispushdt,callback:function(e){t.$set(t.form,"ispushdt",e)},expression:"form.ispushdt"}},[s("el-checkbox",{attrs:{label:"生成动态"}})],1)],1),t._v(" "),s("el-form-item",[3!=t.type?s("el-button",{attrs:{type:"2"},on:{click:function(e){return t.uploadFood(2)}}},[t._v("发布食谱")]):t._e(),t._v(" "),3==t.type?s("el-button",{attrs:{type:"1"},on:{click:function(e){return t.uploadeFood(2)}}},[t._v("确认修改食谱")]):t._e()],1)],2)],1),t._v(" "),s("FooterBottom")],1)},staticRenderFns:[]};var m=s("VU/8")(f,p,!1,function(t){s("7vBx")},"data-v-c255c8be",null);e.default=m.exports}});
//# sourceMappingURL=3.a9438ba6b0138eaba84b.js.map